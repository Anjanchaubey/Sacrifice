<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Caffine</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti JS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        physics: '#d97706', // Amber 600
                        chemistry: '#d97706', // Amber 600
                        math: '#d97706', // Amber 600
                        dark: '#000000', // Pure Black
                        card: '#1a1a1a', // Dark Grey for blending
                        surface: '#f59e0b' // Amber 500 for borders
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-sm': 'bounce-sm 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        'bounce-sm': {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(0.9)' },
                        }
                    },
                    screens: {
                        'xs': '375px',
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fffbeb; /* Lighter amber beige */
            transition: background-color 0.5s ease, color 0.5s ease;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }

        .dark body {
            background-color: #000000; /* Pure Black */
        }

        /* Hide scrollbar for stats carousel */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Premium Checkbox */
        .checkbox-wrapper input:checked + div {
            background-color: currentColor;
            border-color: currentColor;
            transform: scale(1);
        }
        .checkbox-wrapper input:checked + div svg {
            opacity: 1;
            transform: scale(1);
        }
        .checkbox-wrapper div {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Glass Header */
        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        }
        .dark .glass-header {
            background: rgba(0, 0, 0, 0.8); /* Darker glass for black theme */
            border-bottom: 1px solid #f59e0b; /* Amber 500 border */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* Soft Cards */
        .soft-card {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        .dark .soft-card {
            background-color: #1a1a1a; /* Grey blend */
            box-shadow: none; /* Flat aesthetic for pure dark mode */
            border: 1px solid #f59e0b; /* Amber 500 subtle border */
        }

        /* Progress Bar Glow */
        .glow-bar-physics { box-shadow: 0 0 12px rgba(217, 119, 6, 0.4); } /* Amber glow */
        .glow-bar-chemistry { box-shadow: 0 0 12px rgba(217, 119, 6, 0.4); }
        .glow-bar-math { box-shadow: 0 0 12px rgba(217, 119, 6, 0.4); }

        .progress-transition {
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Scrollbar aesthetics */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #333; }
    </style>
</head>
<body class="text-slate-600 dark:text-gray-400 min-h-screen pb-24 selection:bg-purple-100 dark:selection:bg-purple-900/50 dark:selection:text-purple-200">

    <!-- Sticky Header -->
    <header class="fixed top-0 w-full z-50 glass-header">
        <div class="max-w-6xl mx-auto px-4 py-3 md:px-6 md:py-4">
            <div class="flex justify-between items-center mb-3 md:mb-4">
                <div class="flex items-center gap-3 md:gap-4">
                    <button onclick="window.location.href='index.html'" class="h-8 w-8 md:h-9 md:w-9 rounded-full bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 transition-colors flex items-center justify-center text-slate-500 dark:text-gray-400 focus:outline-none tap-highlight-transparent">
                        <i class="fa-solid fa-arrow-left text-xs"></i>
                    </button>
                    <img src="logo.png" alt="Caffine" class="w-12 h-12 md:w-14 md:h-14">
                    <div>
                        <h1 class="text-sm md:text-base font-semibold tracking-tight text-slate-900 dark:text-gray-100 leading-tight">Caffine</h1>
                        <div class="flex items-center gap-2">
                            <span id="sync-status-dot" class="w-1.5 h-1.5 rounded-full bg-slate-300 transition-colors duration-300"></span>
                            <span id="sync-status-text" class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-gray-500">Offline</span>
                        </div>
                    </div>
                </div>
                <button onclick="toggleTheme()" class="h-8 w-8 md:h-9 md:w-9 rounded-full bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 transition-colors flex items-center justify-center text-slate-500 dark:text-gray-400 focus:outline-none tap-highlight-transparent">
                    <i class="fa-solid fa-moon dark:hidden text-xs"></i>
                    <i class="fa-solid fa-sun hidden dark:block text-xs"></i>
                </button>
            </div>
            
            <!-- Global Progress Bar -->
            <div class="flex items-center gap-3 md:gap-4">
                <div class="flex-1 bg-slate-100 dark:bg-white/5 rounded-full h-1 md:h-1.5 overflow-hidden">
                    <div id="global-progress" class="bg-slate-900 dark:bg-white h-full rounded-full progress-transition shadow-[0_0_10px_rgba(0,0,0,0.1)] dark:shadow-[0_0_10px_rgba(255,255,255,0.2)]" style="width: 0%"></div>
                </div>
                <span id="global-percentage" class="text-[10px] md:text-xs font-bold text-slate-900 dark:text-white w-7 text-right font-mono">0%</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 pt-28 md:px-6 md:pt-36">
        
        <!-- Class Selection -->
        <div class="soft-card bg-white dark:bg-card p-4 md:p-6 rounded-2xl mb-6 md:mb-8">
            <h3 class="text-sm md:text-base font-semibold text-slate-900 dark:text-gray-100 mb-4">Select Class & Stream</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="switchSyllabus('class11pcm')" id="btn-class11pcm" class="syllabus-btn p-3 rounded-xl border-2 border-slate-200 dark:border-white/10 text-xs font-medium transition-all hover:border-amber-400 dark:hover:border-amber-400">
                    <div class="text-slate-900 dark:text-gray-100">Class 11</div>
                    <div class="text-slate-500 dark:text-gray-400 text-[10px]">PCM</div>
                </button>
                <button onclick="switchSyllabus('class11pcb')" id="btn-class11pcb" class="syllabus-btn p-3 rounded-xl border-2 border-slate-200 dark:border-white/10 text-xs font-medium transition-all hover:border-amber-400 dark:hover:border-amber-400">
                    <div class="text-slate-900 dark:text-gray-100">Class 11</div>
                    <div class="text-slate-500 dark:text-gray-400 text-[10px]">PCB</div>
                </button>
                <button onclick="switchSyllabus('class12pcm')" id="btn-class12pcm" class="syllabus-btn p-3 rounded-xl border-2 border-slate-200 dark:border-white/10 text-xs font-medium transition-all hover:border-amber-400 dark:hover:border-amber-400">
                    <div class="text-slate-900 dark:text-gray-100">Class 12</div>
                    <div class="text-slate-500 dark:text-gray-400 text-[10px]">PCM</div>
                </button>
                <button onclick="switchSyllabus('class12pcb')" id="btn-class12pcb" class="syllabus-btn p-3 rounded-xl border-2 border-slate-200 dark:border-white/10 text-xs font-medium transition-all hover:border-amber-400 dark:hover:border-amber-400">
                    <div class="text-slate-900 dark:text-gray-100">Class 12</div>
                    <div class="text-slate-500 dark:text-gray-400 text-[10px]">PCB</div>
                </button>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="flex md:grid md:grid-cols-3 overflow-x-auto snap-x snap-mandatory gap-4 mb-6 md:mb-10 pb-4 md:pb-0 hide-scrollbar -mx-4 px-4 md:mx-0 md:px-0">
            <div class="soft-card bg-white dark:bg-card p-5 md:p-6 rounded-2xl flex flex-col justify-between h-28 md:h-32 min-w-[85vw] sm:min-w-[45vw] md:min-w-0 snap-center">
                <div class="flex justify-between items-start">
                    <p class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-gray-500">Tasks Done</p>
                    <i class="fa-solid fa-check-circle text-emerald-500/80 text-lg"></i>
                </div>
                <h3 class="text-2xl md:text-3xl font-semibold tracking-tight text-slate-900 dark:text-gray-100 mt-auto" id="total-tasks-done">0/0</h3>
            </div>
            
            <div class="soft-card bg-white dark:bg-card p-5 md:p-6 rounded-2xl flex flex-col justify-between h-28 md:h-32 min-w-[85vw] sm:min-w-[45vw] md:min-w-0 snap-center">
                <div class="flex justify-between items-start">
                    <p class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-gray-500">Current Rank</p>
                    <i class="fa-solid fa-medal text-amber-500/80 text-lg"></i>
                </div>
                <h3 class="text-2xl md:text-3xl font-semibold tracking-tight text-amber-500 mt-auto" id="user-rank">Novice</h3>
            </div>

            <div class="soft-card bg-white dark:bg-card p-5 md:p-6 rounded-2xl flex flex-col justify-between h-28 md:h-32 min-w-[85vw] sm:min-w-[45vw] md:min-w-0 snap-center">
                <div class="flex justify-between items-start">
                    <p class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-gray-500">Focus Area</p>
                    <i class="fa-solid fa-crosshairs text-rose-500/80 text-lg"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-semibold tracking-tight text-slate-900 dark:text-gray-100 mt-auto truncate" id="focus-area">Balanced</h3>
            </div>
        </div>

        <!-- Subjects Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
            
            <!-- Physics Section -->
            <div class="soft-card bg-white dark:bg-card rounded-2xl overflow-hidden flex flex-col h-full">
                <div class="px-5 py-4 md:px-6 md:py-6 border-b border-slate-50 dark:border-white/5 bg-physics/5 dark:bg-physics/10">
                    <div class="flex justify-between items-end mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-7 h-7 md:w-8 md:h-8 rounded-lg bg-white dark:bg-white/5 flex items-center justify-center text-physics shadow-sm dark:shadow-none dark:border dark:border-white/5">
                                <i class="fa-solid fa-atom text-xs md:text-sm"></i>
                            </div>
                            <h2 class="text-base md:text-lg font-semibold tracking-tight text-slate-900 dark:text-gray-100">Physics</h2>
                        </div>
                        <span id="physics-text" class="text-[10px] md:text-xs font-bold text-physics font-mono">0%</span>
                    </div>
                    <div class="w-full bg-slate-200/50 dark:bg-white/10 rounded-full h-1">
                        <div id="physics-bar" class="bg-physics h-1 rounded-full progress-transition glow-bar-physics" style="width: 0%"></div>
                    </div>
                </div>
                <div id="physics-list" class="p-3 md:p-4 space-y-2 flex-grow">
                    <!-- Javascript will populate this -->
                </div>
            </div>

            <!-- Chemistry Section -->
            <div class="soft-card bg-white dark:bg-card rounded-2xl overflow-hidden flex flex-col h-full">
                <div class="px-5 py-4 md:px-6 md:py-6 border-b border-slate-50 dark:border-white/5 bg-chemistry/5 dark:bg-chemistry/10">
                    <div class="flex justify-between items-end mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-7 h-7 md:w-8 md:h-8 rounded-lg bg-white dark:bg-white/5 flex items-center justify-center text-chemistry shadow-sm dark:shadow-none dark:border dark:border-white/5">
                                <i class="fa-solid fa-flask text-xs md:text-sm"></i>
                            </div>
                            <h2 class="text-base md:text-lg font-semibold tracking-tight text-slate-900 dark:text-gray-100">Chemistry</h2>
                        </div>
                        <span id="chemistry-text" class="text-[10px] md:text-xs font-bold text-chemistry font-mono">0%</span>
                    </div>
                    <div class="w-full bg-slate-200/50 dark:bg-white/10 rounded-full h-1">
                        <div id="chemistry-bar" class="bg-chemistry h-1 rounded-full progress-transition glow-bar-chemistry" style="width: 0%"></div>
                    </div>
                </div>
                <div id="chemistry-list" class="p-3 md:p-4 space-y-2 flex-grow">
                    <!-- Javascript will populate this -->
                </div>
            </div>

            <!-- Third Subject Section -->
            <div class="soft-card bg-white dark:bg-card rounded-2xl overflow-hidden flex flex-col h-full">
                <div class="px-5 py-4 md:px-6 md:py-6 border-b border-slate-50 dark:border-white/5 bg-math/5 dark:bg-math/10">
                    <div class="flex justify-between items-end mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-7 h-7 md:w-8 md:h-8 rounded-lg bg-white dark:bg-white/5 flex items-center justify-center text-math shadow-sm dark:shadow-none dark:border dark:border-white/5">
                                <i id="third-subject-icon" class="fa-solid fa-calculator text-xs md:text-sm"></i>
                            </div>
                            <h2 id="third-subject-title" class="text-base md:text-lg font-semibold tracking-tight text-slate-900 dark:text-gray-100">Maths</h2>
                        </div>
                        <span id="third-subject-text" class="text-[10px] md:text-xs font-bold text-math font-mono">0%</span>
                    </div>
                    <div class="w-full bg-slate-200/50 dark:bg-white/10 rounded-full h-1">
                        <div id="third-subject-bar" class="bg-math h-1 rounded-full progress-transition glow-bar-math" style="width: 0%"></div>
                    </div>
                </div>
                <div id="third-subject-list" class="p-3 md:p-4 space-y-2 flex-grow">
                    <!-- Javascript will populate this -->
                </div>
            </div>

        </div>

        <div class="mt-12 text-center">
            <p class="text-[9px] md:text-[10px] font-medium uppercase tracking-widest text-slate-400 dark:text-gray-600">
                "I am vengeance, I am the night" <span class="mx-1">â€¢</span> Wayne Enterprises
            </p>
        </div>

    </main>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYY2GQqS0tCXb7Oxw8AWXhpexq9e8VRUs",
            authDomain: "aspirehub-32863.firebaseapp.com",
            projectId: "aspirehub-32863",
            storageBucket: "aspirehub-32863.appspot.com",
            messagingSenderId: "686810111182",
            appId: "1:686810111182:web:4290b4b1b6e64934ec449f"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'syllabus-tracker-v1';

        let currentUser = null;
        let unsubscribe = null;
        let userDataListener = null;

        const statusDot = document.getElementById('sync-status-dot');
        const statusText = document.getElementById('sync-status-text');

        function setStatus(state) {
            if (state === 'offline') {
                statusDot.className = "w-1.5 h-1.5 rounded-full bg-slate-300";
                statusText.innerText = "Offline";
            } else if (state === 'syncing') {
                statusDot.className = "w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse";
                statusText.innerText = "Syncing";
            } else if (state === 'synced') {
                statusDot.className = "w-1.5 h-1.5 rounded-full bg-emerald-500";
                statusText.innerText = "Synced";
            }
        }

        // Listen for authentication
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                setStatus('syncing');
                setupRealtimeListener(user.uid);
            } else {
                currentUser = null;
                setStatus('offline');
                setTimeout(() => {
                    if (!auth.currentUser) window.location.href = 'login.html';
                }, 1000);
            }
        });

        function setupRealtimeListener(userId) {
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'data', 'syllabus');
            unsubscribe = onSnapshot(docRef, (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const cloudData = docSnapshot.data();
                    // Sync all syllabus data
                    Object.keys(cloudData).forEach(syllabusKey => {
                        if (cloudData[syllabusKey]) {
                            localStorage.setItem(`syllabusTrackerData_${syllabusKey}`, JSON.stringify(cloudData[syllabusKey]));
                        }
                    });
                    // Update current syllabus data
                    if (cloudData[currentSyllabus]) {
                        window.appData = cloudData[currentSyllabus];
                        init();
                    }
                    setStatus('synced');
                } else {
                    saveToCloud();
                }
            }, (error) => {
                console.error("Sync Error:", error);
                setStatus('offline');
            });
        }

        window.saveToCloud = async function() {
            if (!currentUser) {
                setStatus('offline');
                return;
            }
            setStatus('syncing');
            try {
                // Collect all syllabus data from localStorage
                const allSyllabusData = {};
                ['class11pcm', 'class11pcb', 'class12pcm', 'class12pcb'].forEach(syllabusKey => {
                    const data = localStorage.getItem(`syllabusTrackerData_${syllabusKey}`);
                    if (data) {
                        allSyllabusData[syllabusKey] = JSON.parse(data);
                    }
                });
                await setDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'data', 'syllabus'), allSyllabusData);
                setStatus('synced');
            } catch (e) {
                console.error("Save Error", e);
                setStatus('offline');
            }
        }
    </script>

    <script>
        const syllabusData = {
            class11pcm: {
                physics: [
                    { name: "Physical World and Measurement", theory: false, questions: false },
                    { name: "Kinematics", theory: false, questions: false },
                    { name: "Laws of Motion", theory: false, questions: false },
                    { name: "Work, Energy and Power", theory: false, questions: false },
                    { name: "Motion of System of Particles and Rigid Body", theory: false, questions: false },
                    { name: "Gravitation", theory: false, questions: false },
                    { name: "Properties of Bulk Matter", theory: false, questions: false },
                    { name: "Thermodynamics", theory: false, questions: false },
                    { name: "Behaviour of Perfect Gas and Kinetic Theory", theory: false, questions: false },
                    { name: "Oscillations and Waves", theory: false, questions: false }
                ],
                chemistry: [
                    { name: "Some Basic Concepts of Chemistry", theory: false, questions: false },
                    { name: "Structure of Atom", theory: false, questions: false },
                    { name: "States of Matter", theory: false, questions: false },
                    { name: "Thermodynamics", theory: false, questions: false },
                    { name: "Equilibrium", theory: false, questions: false },
                    { name: "Classification of Elements and Periodicity", theory: false, questions: false },
                    { name: "Chemical Bonding and Molecular Structure", theory: false, questions: false },
                    { name: "Redox Reactions", theory: false, questions: false },
                    { name: "Hydrogen", theory: false, questions: false },
                    { name: "s-Block Elements", theory: false, questions: false },
                    { name: "Some p-Block Elements", theory: false, questions: false },
                    { name: "Organic Chemistry - Basic Principles", theory: false, questions: false },
                    { name: "Purification and Characterisation of Organic Compounds", theory: false, questions: false },
                    { name: "Hydrocarbons", theory: false, questions: false },
                    { name: "Environmental Chemistry", theory: false, questions: false }
                ],
                math: [
                    { name: "Sets", theory: false, questions: false },
                    { name: "Relations and Functions", theory: false, questions: false },
                    { name: "Trigonometric Functions", theory: false, questions: false },
                    { name: "Principle of Mathematical Induction", theory: false, questions: false },
                    { name: "Complex Numbers and Quadratic Equations", theory: false, questions: false },
                    { name: "Linear Inequalities", theory: false, questions: false },
                    { name: "Permutations and Combinations", theory: false, questions: false },
                    { name: "Binomial Theorem", theory: false, questions: false },
                    { name: "Sequences and Series", theory: false, questions: false },
                    { name: "Straight Lines", theory: false, questions: false },
                    { name: "Conic Sections", theory: false, questions: false },
                    { name: "Introduction to Three Dimensional Geometry", theory: false, questions: false },
                    { name: "Limits and Derivatives", theory: false, questions: false },
                    { name: "Mathematical Reasoning", theory: false, questions: false },
                    { name: "Statistics", theory: false, questions: false },
                    { name: "Probability", theory: false, questions: false }
                ]
            },
            class11pcb: {
                physics: [
                    { name: "Physical World and Measurement", theory: false, questions: false },
                    { name: "Kinematics", theory: false, questions: false },
                    { name: "Laws of Motion", theory: false, questions: false },
                    { name: "Work, Energy and Power", theory: false, questions: false },
                    { name: "Motion of System of Particles and Rigid Body", theory: false, questions: false },
                    { name: "Gravitation", theory: false, questions: false },
                    { name: "Properties of Bulk Matter", theory: false, questions: false },
                    { name: "Thermodynamics", theory: false, questions: false },
                    { name: "Behaviour of Perfect Gas and Kinetic Theory", theory: false, questions: false },
                    { name: "Oscillations and Waves", theory: false, questions: false }
                ],
                chemistry: [
                    { name: "Some Basic Concepts of Chemistry", theory: false, questions: false },
                    { name: "Structure of Atom", theory: false, questions: false },
                    { name: "States of Matter", theory: false, questions: false },
                    { name: "Thermodynamics", theory: false, questions: false },
                    { name: "Equilibrium", theory: false, questions: false },
                    { name: "Classification of Elements and Periodicity", theory: false, questions: false },
                    { name: "Chemical Bonding and Molecular Structure", theory: false, questions: false },
                    { name: "Redox Reactions", theory: false, questions: false },
                    { name: "Hydrogen", theory: false, questions: false },
                    { name: "s-Block Elements", theory: false, questions: false },
                    { name: "Some p-Block Elements", theory: false, questions: false },
                    { name: "Organic Chemistry - Basic Principles", theory: false, questions: false },
                    { name: "Purification and Characterisation of Organic Compounds", theory: false, questions: false },
                    { name: "Hydrocarbons", theory: false, questions: false },
                    { name: "Environmental Chemistry", theory: false, questions: false }
                ],
                biology: [
                    { name: "Diversity in Living World", theory: false, questions: false },
                    { name: "Structural Organisation in Plants", theory: false, questions: false },
                    { name: "Cell Structure and Function", theory: false, questions: false },
                    { name: "Plant Physiology", theory: false, questions: false },
                    { name: "Plant Kingdom", theory: false, questions: false },
                    { name: "Structural Organisation in Animals", theory: false, questions: false },
                    { name: "Human Physiology", theory: false, questions: false },
                    { name: "Animal Kingdom", theory: false, questions: false }
                ]
            },
            class12pcm: {
                physics: [
                    { name: "Electrostatics", theory: false, questions: false },
                    { name: "Current Electricity", theory: false, questions: false },
                    { name: "Magnetic Effects of Current and Magnetism", theory: false, questions: false },
                    { name: "Electromagnetic Induction", theory: false, questions: false },
                    { name: "Alternating Currents", theory: false, questions: false },
                    { name: "Electromagnetic Waves", theory: false, questions: false },
                    { name: "Ray Optics and Optical Instruments", theory: false, questions: false },
                    { name: "Wave Optics", theory: false, questions: false },
                    { name: "Dual Nature of Radiation and Matter", theory: false, questions: false },
                    { name: "Atoms", theory: false, questions: false },
                    { name: "Nuclei", theory: false, questions: false },
                    { name: "Semiconductor Electronics", theory: false, questions: false }
                ],
                chemistry: [
                    { name: "Solutions", theory: false, questions: false },
                    { name: "Electrochemistry", theory: false, questions: false },
                    { name: "Chemical Kinetics", theory: false, questions: false },
                    { name: "Surface Chemistry", theory: false, questions: false },
                    { name: "General Principles and Processes of Isolation of Elements", theory: false, questions: false },
                    { name: "p-Block Elements", theory: false, questions: false },
                    { name: "d- and f-Block Elements", theory: false, questions: false },
                    { name: "Coordination Compounds", theory: false, questions: false },
                    { name: "Haloalkanes and Haloarenes", theory: false, questions: false },
                    { name: "Alcohols, Phenols and Ethers", theory: false, questions: false },
                    { name: "Aldehydes, Ketones and Carboxylic Acids", theory: false, questions: false },
                    { name: "Amines", theory: false, questions: false },
                    { name: "Biomolecules", theory: false, questions: false },
                    { name: "Polymers", theory: false, questions: false },
                    { name: "Chemistry in Everyday Life", theory: false, questions: false }
                ],
                math: [
                    { name: "Relations and Functions", theory: false, questions: false },
                    { name: "Inverse Trigonometric Functions", theory: false, questions: false },
                    { name: "Matrices", theory: false, questions: false },
                    { name: "Determinants", theory: false, questions: false },
                    { name: "Continuity and Differentiability", theory: false, questions: false },
                    { name: "Applications of Derivatives", theory: false, questions: false },
                    { name: "Integrals", theory: false, questions: false },
                    { name: "Applications of Integrals", theory: false, questions: false },
                    { name: "Differential Equations", theory: false, questions: false },
                    { name: "Vector Algebra", theory: false, questions: false },
                    { name: "Three Dimensional Geometry", theory: false, questions: false },
                    { name: "Linear Programming", theory: false, questions: false },
                    { name: "Probability", theory: false, questions: false }
                ]
            },
            class12pcb: {
                physics: [
                    { name: "Electrostatics", theory: false, questions: false },
                    { name: "Current Electricity", theory: false, questions: false },
                    { name: "Magnetic Effects of Current and Magnetism", theory: false, questions: false },
                    { name: "Electromagnetic Induction and Alternating Currents", theory: false, questions: false },
                    { name: "Electromagnetic Waves", theory: false, questions: false },
                    { name: "Optics", theory: false, questions: false },
                    { name: "Dual Nature of Matter and Radiation", theory: false, questions: false },
                    { name: "Atoms and Nuclei", theory: false, questions: false },
                    { name: "Electronic Devices", theory: false, questions: false }
                ],
                chemistry: [
                    { name: "Solutions", theory: false, questions: false },
                    { name: "Electrochemistry", theory: false, questions: false },
                    { name: "Chemical Kinetics", theory: false, questions: false },
                    { name: "Surface Chemistry", theory: false, questions: false },
                    { name: "General Principles and Processes of Isolation of Elements", theory: false, questions: false },
                    { name: "The p-Block Elements", theory: false, questions: false },
                    { name: "The d and f-Block Elements", theory: false, questions: false },
                    { name: "Coordination Compounds", theory: false, questions: false },
                    { name: "Haloalkanes and Haloarenes", theory: false, questions: false },
                    { name: "Alcohols, Phenols and Ethers", theory: false, questions: false },
                    { name: "Aldehydes, Ketones and Carboxylic Acids", theory: false, questions: false },
                    { name: "Amines", theory: false, questions: false },
                    { name: "Biomolecules", theory: false, questions: false }
                ],
                biology: [
                    { name: "Reproduction in Organisms", theory: false, questions: false },
                    { name: "Sexual Reproduction in Flowering Plants", theory: false, questions: false },
                    { name: "Principles of Inheritance and Variation", theory: false, questions: false },
                    { name: "Molecular Basis of Inheritance", theory: false, questions: false },
                    { name: "Biology and Human Welfare", theory: false, questions: false },
                    { name: "Biotechnology and its Applications", theory: false, questions: false },
                    { name: "Ecosystem", theory: false, questions: false },
                    { name: "Human Reproduction", theory: false, questions: false },
                    { name: "Reproductive Health", theory: false, questions: false },
                    { name: "Evolution", theory: false, questions: false },
                    { name: "Human Health and Disease", theory: false, questions: false },
                    { name: "Biotechnology: Principles and Processes", theory: false, questions: false },
                    { name: "Organisms and Populations", theory: false, questions: false }
                ]
            }
        };

        let currentSyllabus = localStorage.getItem('currentSyllabus') || 'class11pcm';
        window.appData = JSON.parse(localStorage.getItem(`syllabusTrackerData_${currentSyllabus}`)) || JSON.parse(JSON.stringify(syllabusData[currentSyllabus]));

        window.switchSyllabus = function(syllabusType) {
            localStorage.setItem(`syllabusTrackerData_${currentSyllabus}`, JSON.stringify(window.appData));
            currentSyllabus = syllabusType;
            localStorage.setItem('currentSyllabus', currentSyllabus);
            window.appData = JSON.parse(localStorage.getItem(`syllabusTrackerData_${currentSyllabus}`)) || JSON.parse(JSON.stringify(syllabusData[currentSyllabus]));
            updateSyllabusButtons();
            updateSubjectLabels();
            init();
        }

        function updateSyllabusButtons() {
            document.querySelectorAll('.syllabus-btn').forEach(btn => {
                btn.classList.remove('border-amber-400', 'bg-amber-50', 'dark:bg-amber-900/20');
                btn.classList.add('border-slate-200', 'dark:border-white/10');
            });
            const activeBtn = document.getElementById(`btn-${currentSyllabus}`);
            if (activeBtn) {
                activeBtn.classList.remove('border-slate-200', 'dark:border-white/10');
                activeBtn.classList.add('border-amber-400', 'bg-amber-50', 'dark:bg-amber-900/20');
            }
        }

        function updateSubjectLabels() {
            const thirdSubject = currentSyllabus.includes('pcb') ? 'biology' : 'math';
            const thirdSubjectTitle = thirdSubject === 'biology' ? 'Biology' : 'Maths';
            const thirdSubjectIcon = thirdSubject === 'biology' ? 'fa-dna' : 'fa-calculator';
            document.getElementById('third-subject-title').textContent = thirdSubjectTitle;
            document.getElementById('third-subject-icon').className = `fa-solid ${thirdSubjectIcon} text-xs md:text-sm`;
        }

        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            if(document.documentElement.classList.contains('dark')){
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        }

        function renderList(subject, listId, colorClass) {
            const container = document.getElementById(listId);
            container.innerHTML = '';
            if (!window.appData[subject]) return;
            window.appData[subject].forEach((chapter, index) => {
                const isDone = chapter.theory && chapter.questions;
                const item = document.createElement('div');
                item.className = `p-3 rounded-xl transition-all duration-200 hover:bg-slate-50 dark:hover:bg-white/5 flex flex-row items-center justify-between gap-3 group`;
                
                const html = `
                    <div class="flex-1 min-w-0">
                        <h4 class="font-medium text-[13px] md:text-[15px] text-slate-700 dark:text-gray-300 ${isDone ? 'line-through text-slate-400 dark:text-gray-600 decoration-slate-300 dark:decoration-gray-700' : ''} transition-all truncate">${chapter.name}</h4>
                        ${chapter.desc ? `<p class="text-[9px] md:text-[10px] uppercase tracking-wide text-slate-400 dark:text-gray-600 mt-0.5 truncate">${chapter.desc}</p>` : ''}
                    </div>
                    
                    <div class="flex items-center gap-2 md:gap-3 shrink-0">
                        <label class="checkbox-wrapper cursor-pointer flex items-center gap-1.5 md:gap-2 group/check p-1">
                            <span class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-slate-300 dark:text-gray-600 group-hover/check:text-${colorClass} transition-colors">Theory</span>
                            <div class="relative w-4 h-4 md:w-5 md:h-5">
                                <input type="checkbox" class="hidden" 
                                    onchange="updateStatus('${subject}', ${index}, 'theory')" 
                                    ${chapter.theory ? 'checked' : ''}>
                                <div class="w-full h-full border border-slate-300 dark:border-gray-700 rounded-md flex items-center justify-center text-white transition-all shadow-sm group-hover/check:border-${colorClass} dark:bg-white/5">
                                    <svg class="w-2.5 h-2.5 md:w-3 md:h-3 opacity-0 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                            </div>
                        </label>

                        <label class="checkbox-wrapper cursor-pointer flex items-center gap-1.5 md:gap-2 group/check p-1">
                             <span class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-slate-300 dark:text-gray-600 group-hover/check:text-${colorClass} transition-colors">Prob</span>
                            <div class="relative w-4 h-4 md:w-5 md:h-5">
                                <input type="checkbox" class="hidden" 
                                    onchange="updateStatus('${subject}', ${index}, 'questions')" 
                                    ${chapter.questions ? 'checked' : ''}>
                                <div class="w-full h-full border border-slate-300 dark:border-gray-700 rounded-md flex items-center justify-center text-white transition-all shadow-sm group-hover/check:border-${colorClass} dark:bg-white/5">
                                    <svg class="w-2.5 h-2.5 md:w-3 md:h-3 opacity-0 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                            </div>
                        </label>
                    </div>
                `;
                item.innerHTML = html;
                container.appendChild(item);
            });
        }

        window.updateStatus = function(subject, index, type) {
            window.appData[subject][index][type] = !window.appData[subject][index][type];
            window.saveDataLocal();
            if (window.saveToCloud) window.saveToCloud();
            calculateStats();
            
            const colorMap = { physics: 'physics', chemistry: 'chemistry', math: 'math', biology: 'math' };
            renderList(subject, `${subject === 'math' || subject === 'biology' ? 'third-subject' : subject}-list`, colorMap[subject]);
        }

        window.saveDataLocal = function() {
            localStorage.setItem(`syllabusTrackerData_${currentSyllabus}`, JSON.stringify(window.appData));
        }

        window.calculateStats = function() {
            let totalTasks = 0;
            let completedTasks = 0;
            const thirdSubject = currentSyllabus.includes('pcb') ? 'biology' : 'math';
            const subjects = ['physics', 'chemistry', thirdSubject];
            const stats = {};

            subjects.forEach(sub => {
                if (!window.appData[sub]) return;
                let subTotal = window.appData[sub].length * 2;
                let subDone = 0;
                
                window.appData[sub].forEach(ch => {
                    if(ch.theory) subDone++;
                    if(ch.questions) subDone++;
                });

                stats[sub] = { total: subTotal, done: subDone, percent: subTotal === 0 ? 0 : Math.round((subDone/subTotal)*100) };
                
                totalTasks += subTotal;
                completedTasks += subDone;

                const barId = sub === 'math' || sub === 'biology' ? 'third-subject-bar' : `${sub}-bar`;
                const textId = sub === 'math' || sub === 'biology' ? 'third-subject-text' : `${sub}-text`;
                document.getElementById(barId).style.width = `${stats[sub].percent}%`;
                document.getElementById(textId).innerText = `${stats[sub].percent}%`;
            });

            const globalPercent = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);
            document.getElementById('global-progress').style.width = `${globalPercent}%`;
            document.getElementById('global-percentage').innerText = `${globalPercent}%`;
            document.getElementById('total-tasks-done').innerText = `${completedTasks}/${totalTasks}`;

            const rankEl = document.getElementById('user-rank');
            if(globalPercent === 0) rankEl.innerText = "Robin";
            else if(globalPercent < 25) rankEl.innerText = "Nightwing";
            else if(globalPercent < 50) rankEl.innerText = "Red Hood";
            else if(globalPercent < 75) rankEl.innerText = "Batman";
            else if(globalPercent < 100) rankEl.innerText = "Dark Knight";
            else {
                rankEl.innerText = "Justice League";
                if(!sessionStorage.getItem('confettiShown')) {
                    triggerConfetti();
                    sessionStorage.setItem('confettiShown', 'true');
                }
            }

            let minPercent = 100;
            let lagSubject = "Balanced";
            subjects.forEach(sub => {
                if(stats[sub].percent < minPercent) {
                    minPercent = stats[sub].percent;
                    lagSubject = sub.charAt(0).toUpperCase() + sub.slice(1);
                }
            });
            
            if(stats.physics.percent === stats.chemistry.percent && stats.chemistry.percent === stats[thirdSubject].percent && stats[thirdSubject].percent > 0) {
                lagSubject = "Consistent";
            }
            if(globalPercent === 100) lagSubject = "Gotham Protected";

            document.getElementById('focus-area').innerText = lagSubject;
        }

        function triggerConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        window.init = function() {
            const thirdSubject = currentSyllabus.includes('pcb') ? 'biology' : 'math';
            renderList('physics', 'physics-list', 'physics');
            renderList('chemistry', 'chemistry-list', 'chemistry');
            renderList(thirdSubject, 'third-subject-list', 'math');
            calculateStats();
        }

        updateSyllabusButtons();
        updateSubjectLabels();
        init();
    </script>
</body>
</html>
